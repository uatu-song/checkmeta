flowchart TD
    %% Main entrypoints
    main[main.py\nEntry Point] --> meta_sim[meta_simulator.py\nCore Implementation]
    meta_sim --> MetaLeagueSimulator[MetaLeagueSimulator\nMain Simulator Class]
    
    %% Main Systems
    MetaLeagueSimulator --> Traits[Trait System]
    MetaLeagueSimulator --> ChessEngine[Chess Engine Integration]
    MetaLeagueSimulator --> Convergence[Convergence Processing]
    MetaLeagueSimulator --> Combat[Combat Resolution]
    MetaLeagueSimulator --> Morale[Morale System]
    MetaLeagueSimulator --> Recovery[HP/Stamina Recovery]
    MetaLeagueSimulator --> Experience[XP Calculation]
    MetaLeagueSimulator --> DataLoading[Data Loading]
    
    %% Data flows
    DataLoading --> Lineups[Excel Lineup Importer]
    Lineups -->|Create| Characters[Character Generation]
    Lineups -->|Create| Teams[Team Formation]
    
    %% Simulation loop
    MetaLeagueSimulator -->|Start| SimLoop[Simulation Loop]
    SimLoop --> Openings[Apply Role-Based Openings]
    Openings --> MovePhase[Move Selection Phase]
    MovePhase --> Convergence
    MovePhase --> MaterialChange[Material Calculation]
    MaterialChange --> Combat
    Combat --> DamageCalc[Damage Resolution]
    SimLoop --> EndRound[End of Round Effects]
    EndRound --> Recovery
    EndRound --> TraitActivation[Trait Activation]
    
    %% Results processing
    SimLoop -->|Complete| ResultCalc[Result Calculation]
    ResultCalc --> Experience
    ResultCalc --> Morale
    
    %% Modular structure
    subgraph ConfigFiles[Configuration]
        RoleOpenings[Role-Based Openings]
        TraitDefinitions[Trait Definitions]
        GameParameters[Game Parameters]
    end
    
    subgraph Models[Data Models]
        CharacterModel[Character]
        TeamModel[Team] 
        MatchModel[Match Results]
    end
    
    subgraph Systems[Core Systems]
        Traits
        ChessEngine
        Morale
        Synergy[Team Synergy]
        Leadership[Leadership Bonuses]
        CircuitSystem[Team Circuits]
    end
    
    subgraph Simulation[Simulation Logic]
        Combat
        Convergence
        MaterialChange
        Recovery
    end
    
    %% Relationships between module groups
    ConfigFiles --> MetaLeagueSimulator
    Models --> MetaLeagueSimulator
    Systems --> MetaLeagueSimulator
    Simulation --> MetaLeagueSimulator
    
    %% External tools
    Stockfish[Stockfish Chess Engine] -->|AI Move Selection| ChessEngine
    ExcelFiles[Excel Files] -->|Team Data| Lineups
    
    %% Outputs
    MetaLeagueSimulator -->|Generate| MatchResults[Match Results]
    MatchResults --> JSONExport[Export Results to JSON]
